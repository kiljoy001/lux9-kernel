// Font rendering for framebuffer
package fbdriver

// Font represents a bitmap font
type Font struct {
	Width  int
	Height int
	Glyphs map[rune][]byte // Bitmap data for each character
}

// LoadVGAFont loads a classic 8x16 VGA font
func LoadVGAFont() *Font {
	font := &Font{
		Width:  8,
		Height: 16,
		Glyphs: make(map[rune][]byte),
	}

	// Load basic ASCII glyphs (32-126)
	// Each glyph is 16 bytes (8 pixels wide, 16 rows high)
	// Bit 7 = leftmost pixel, bit 0 = rightmost pixel

	// Space (32)
	font.Glyphs[' '] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	}

	// ! (33)
	font.Glyphs['!'] = []byte{
		0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
		0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00,
	}

	// " (34)
	font.Glyphs['"'] = []byte{
		0x00, 0x66, 0x66, 0x66, 0x24, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	}

	// # (35)
	font.Glyphs['#'] = []byte{
		0x00, 0x00, 0x6C, 0x6C, 0xFE, 0x6C, 0x6C, 0x6C,
		0xFE, 0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00,
	}

	// A (65)
	font.Glyphs['A'] = []byte{
		0x00, 0x00, 0x10, 0x38, 0x6C, 0xC6, 0xC6, 0xFE,
		0xC6, 0xC6, 0xC6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	// B (66)
	font.Glyphs['B'] = []byte{
		0x00, 0x00, 0xFC, 0x66, 0x66, 0x66, 0x7C, 0x66,
		0x66, 0x66, 0x66, 0xFC, 0x00, 0x00, 0x00, 0x00,
	}

	// C (67)
	font.Glyphs['C'] = []byte{
		0x00, 0x00, 0x3C, 0x66, 0xC2, 0xC0, 0xC0, 0xC0,
		0xC0, 0xC2, 0x66, 0x3C, 0x00, 0x00, 0x00, 0x00,
	}

	// D (68)
	font.Glyphs['D'] = []byte{
		0x00, 0x00, 0xF8, 0x6C, 0x66, 0x66, 0x66, 0x66,
		0x66, 0x66, 0x6C, 0xF8, 0x00, 0x00, 0x00, 0x00,
	}

	// E (69)
	font.Glyphs['E'] = []byte{
		0x00, 0x00, 0xFE, 0x66, 0x62, 0x68, 0x78, 0x68,
		0x60, 0x62, 0x66, 0xFE, 0x00, 0x00, 0x00, 0x00,
	}

	// H (72)
	font.Glyphs['H'] = []byte{
		0x00, 0x00, 0xC6, 0xC6, 0xC6, 0xC6, 0xFE, 0xC6,
		0xC6, 0xC6, 0xC6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	// L (76)
	font.Glyphs['L'] = []byte{
		0x00, 0x00, 0xF0, 0x60, 0x60, 0x60, 0x60, 0x60,
		0x60, 0x62, 0x66, 0xFE, 0x00, 0x00, 0x00, 0x00,
	}

	// O (79)
	font.Glyphs['O'] = []byte{
		0x00, 0x00, 0x38, 0x6C, 0xC6, 0xC6, 0xC6, 0xC6,
		0xC6, 0xC6, 0x6C, 0x38, 0x00, 0x00, 0x00, 0x00,
	}

	// W (87)
	font.Glyphs['W'] = []byte{
		0x00, 0x00, 0xC6, 0xC6, 0xC6, 0xC6, 0xD6, 0xD6,
		0xD6, 0xFE, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00,
	}

	// a (97)
	font.Glyphs['a'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x0C, 0x7C,
		0xCC, 0xCC, 0xCC, 0x76, 0x00, 0x00, 0x00, 0x00,
	}

	// b (98)
	font.Glyphs['b'] = []byte{
		0x00, 0x00, 0xE0, 0x60, 0x60, 0x78, 0x6C, 0x66,
		0x66, 0x66, 0x66, 0xDC, 0x00, 0x00, 0x00, 0x00,
	}

	// c (99)
	font.Glyphs['c'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0xC6, 0xC0,
		0xC0, 0xC0, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	// d (100)
	font.Glyphs['d'] = []byte{
		0x00, 0x00, 0x1C, 0x0C, 0x0C, 0x3C, 0x6C, 0xCC,
		0xCC, 0xCC, 0xCC, 0x76, 0x00, 0x00, 0x00, 0x00,
	}

	// e (101)
	font.Glyphs['e'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0xC6, 0xFE,
		0xC0, 0xC0, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	// h (104)
	font.Glyphs['h'] = []byte{
		0x00, 0x00, 0xE0, 0x60, 0x60, 0x6C, 0x76, 0x66,
		0x66, 0x66, 0x66, 0xE6, 0x00, 0x00, 0x00, 0x00,
	}

	// l (108)
	font.Glyphs['l'] = []byte{
		0x00, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18,
		0x18, 0x18, 0x18, 0x3C, 0x00, 0x00, 0x00, 0x00,
	}

	// o (111)
	font.Glyphs['o'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0xC6, 0xC6,
		0xC6, 0xC6, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	// r (114)
	font.Glyphs['r'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xDC, 0x76, 0x66,
		0x60, 0x60, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x00,
	}

	// w (119)
	font.Glyphs['w'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xC6, 0xC6, 0xD6,
		0xD6, 0xD6, 0xFE, 0x6C, 0x00, 0x00, 0x00, 0x00,
	}

	// 0 (48)
	font.Glyphs['0'] = []byte{
		0x00, 0x00, 0x38, 0x6C, 0xC6, 0xC6, 0xD6, 0xD6,
		0xC6, 0xC6, 0x6C, 0x38, 0x00, 0x00, 0x00, 0x00,
	}

	// 1 (49)
	font.Glyphs['1'] = []byte{
		0x00, 0x00, 0x18, 0x38, 0x78, 0x18, 0x18, 0x18,
		0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00,
	}

	// 2 (50)
	font.Glyphs['2'] = []byte{
		0x00, 0x00, 0x7C, 0xC6, 0x06, 0x0C, 0x18, 0x30,
		0x60, 0xC0, 0xC6, 0xFE, 0x00, 0x00, 0x00, 0x00,
	}

	// 3 (51)
	font.Glyphs['3'] = []byte{
		0x00, 0x00, 0x7C, 0xC6, 0x06, 0x06, 0x3C, 0x06,
		0x06, 0x06, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	// 9 (57)
	font.Glyphs['9'] = []byte{
		0x00, 0x00, 0x7C, 0xC6, 0xC6, 0xC6, 0x7E, 0x06,
		0x06, 0x06, 0x0C, 0x78, 0x00, 0x00, 0x00, 0x00,
	}

	// - (45)
	font.Glyphs['-'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	}

	// . (46)
	font.Glyphs['.'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00,
	}

	// : (58)
	font.Glyphs[':'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00,
		0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00,
	}

	// / (47)
	font.Glyphs['/'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x02, 0x06, 0x0C, 0x18,
		0x30, 0x60, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00,
	}

	// Fill in remaining lowercase letters to make it more complete
	font.Glyphs['f'] = []byte{
		0x00, 0x00, 0x1E, 0x33, 0x30, 0x30, 0xFC, 0x30,
		0x30, 0x30, 0x30, 0x78, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['g'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xCC, 0xCC,
		0xCC, 0xCC, 0x7C, 0x0C, 0xCC, 0x78, 0x00, 0x00,
	}

	font.Glyphs['i'] = []byte{
		0x00, 0x00, 0x0C, 0x0C, 0x00, 0x1C, 0x0C, 0x0C,
		0x0C, 0x0C, 0x0C, 0x1E, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['k'] = []byte{
		0x00, 0x00, 0xE0, 0x60, 0x60, 0x66, 0x6C, 0x78,
		0x6C, 0x66, 0x66, 0xE6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['m'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xEC, 0xFE, 0xD6,
		0xD6, 0xD6, 0xD6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['n'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xDC, 0x66, 0x66,
		0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['p'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xDC, 0x66, 0x66,
		0x66, 0x66, 0x7C, 0x60, 0x60, 0xF0, 0x00, 0x00,
	}

	font.Glyphs['s'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0xC6, 0x60,
		0x38, 0x0C, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['t'] = []byte{
		0x00, 0x00, 0x10, 0x30, 0x30, 0xFC, 0x30, 0x30,
		0x30, 0x30, 0x36, 0x1C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['u'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0xCC,
		0xCC, 0xCC, 0xCC, 0x76, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['v'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xC6, 0xC6, 0xC6,
		0xC6, 0x6C, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['x'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xC6, 0x6C, 0x38,
		0x38, 0x38, 0x6C, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['y'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xC6, 0xC6, 0xC6,
		0xC6, 0xC6, 0x7E, 0x06, 0x0C, 0xF8, 0x00, 0x00,
	}

	font.Glyphs['z'] = []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xCC, 0x18,
		0x30, 0x60, 0xC6, 0xFE, 0x00, 0x00, 0x00, 0x00,
	}

	// Add more uppercase letters
	font.Glyphs['F'] = []byte{
		0x00, 0x00, 0xFE, 0x66, 0x62, 0x68, 0x78, 0x68,
		0x60, 0x60, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['G'] = []byte{
		0x00, 0x00, 0x3C, 0x66, 0xC2, 0xC0, 0xC0, 0xDE,
		0xC6, 0xC6, 0x66, 0x3A, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['I'] = []byte{
		0x00, 0x00, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18,
		0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['K'] = []byte{
		0x00, 0x00, 0xE6, 0x66, 0x6C, 0x6C, 0x78, 0x6C,
		0x6C, 0x66, 0x66, 0xE6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['M'] = []byte{
		0x00, 0x00, 0xC6, 0xEE, 0xFE, 0xFE, 0xD6, 0xC6,
		0xC6, 0xC6, 0xC6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['N'] = []byte{
		0x00, 0x00, 0xC6, 0xE6, 0xF6, 0xFE, 0xDE, 0xCE,
		0xC6, 0xC6, 0xC6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['P'] = []byte{
		0x00, 0x00, 0xFC, 0x66, 0x66, 0x66, 0x7C, 0x60,
		0x60, 0x60, 0x60, 0xF0, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['R'] = []byte{
		0x00, 0x00, 0xFC, 0x66, 0x66, 0x66, 0x7C, 0x6C,
		0x66, 0x66, 0x66, 0xE6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['S'] = []byte{
		0x00, 0x00, 0x7C, 0xC6, 0xC6, 0x60, 0x38, 0x0C,
		0x06, 0xC6, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['T'] = []byte{
		0x00, 0x00, 0x7E, 0x7E, 0x5A, 0x18, 0x18, 0x18,
		0x18, 0x18, 0x18, 0x3C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['U'] = []byte{
		0x00, 0x00, 0xC6, 0xC6, 0xC6, 0xC6, 0xC6, 0xC6,
		0xC6, 0xC6, 0xC6, 0x7C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['V'] = []byte{
		0x00, 0x00, 0xC6, 0xC6, 0xC6, 0xC6, 0xC6, 0xC6,
		0xC6, 0x6C, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['X'] = []byte{
		0x00, 0x00, 0xC6, 0xC6, 0x6C, 0x6C, 0x38, 0x38,
		0x6C, 0x6C, 0xC6, 0xC6, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['Y'] = []byte{
		0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18,
		0x18, 0x18, 0x18, 0x3C, 0x00, 0x00, 0x00, 0x00,
	}

	font.Glyphs['Z'] = []byte{
		0x00, 0x00, 0xFE, 0xC6, 0x86, 0x0C, 0x18, 0x30,
		0x60, 0xC2, 0xC6, 0xFE, 0x00, 0x00, 0x00, 0x00,
	}

	// Default glyph for unknown characters (?)
	font.Glyphs['?'] = []byte{
		0x00, 0x00, 0x7C, 0xC6, 0xC6, 0x0C, 0x18, 0x18,
		0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00,
	}

	return font
}

// GetGlyph returns the bitmap for a character
func (f *Font) GetGlyph(ch rune) []byte {
	if glyph, ok := f.Glyphs[ch]; ok {
		return glyph
	}
	// Return '?' for unknown characters
	return f.Glyphs['?']
}
